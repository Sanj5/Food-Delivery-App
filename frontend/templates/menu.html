<!DOCTYPE html>
<html>
<head>
    <title>Menu - Food Delivery</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="navbar">
        <h1>üçΩÔ∏è Food Delivery</h1>
        <div>
            <span>Hello, {{ user_name }}!</span>
            <a href="{{ url_for('restaurants') }}">Back to Restaurants</a>
            <a href="{{ url_for('logout') }}">Logout</a>
        </div>
    </div>
    
    <div class="container">
        <div class="menu-header">
            <h2>{{ restaurant.name }}</h2>
            <a href="{{ url_for('cart') }}" class="btn btn-cart">
                üõí View Cart <span id="cart-count" class="cart-badge" style="display: none;">0</span>
            </a>
        </div>
        <p><strong>Cuisine:</strong> {{ restaurant.cuisine }} | <strong>Rating:</strong> ‚≠ê {{ restaurant.rating }}</p>
        
        {% if menu %}
            <div class="menu-grid vertical">
                {% for item in menu %}
                    <div class="menu-item">
                        <img class="menu-image" src="{{ item.image_url or 'https://placehold.co/400x250?text=Food' }}" alt="{{ item.item_name }}">
                        <div class="menu-info">
                            <h3>{{ item.item_name }}</h3>
                            <p>{{ item.description }}</p>
                            <p class="price">‚Çπ{{ item.price }}</p>
                            <label for="qty-{{ item.item_id }}">Qty</label>
                            <input id="qty-{{ item.item_id }}" type="number" value="1" min="1" class="qty-input">
                            <button class="btn" onclick="addToCart('{{ item.item_id }}', '{{ item.item_name }}', {{ item.price }})">Add to Cart</button>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p>No menu items available.</p>
        {% endif %}
    </div>
    
    <script>
        let cart = {};
        
        function loadCart() {
            const savedCart = localStorage.getItem('cart');
            const savedRestaurant = localStorage.getItem('currentRestaurant');
            
            if (savedCart) {
                cart = JSON.parse(savedCart);
            }
            
            // Store current restaurant info
            const restaurant = {
                id: '{{ restaurant.id }}',
                name: '{{ restaurant.name }}'
            };
            localStorage.setItem('currentRestaurant', JSON.stringify(restaurant));
            
            updateCartBadge();
        }
        
        function addToCart(itemId, itemName, price) {
            const qtyInput = document.getElementById('qty-' + itemId);
            let qty = 1;
            if (qtyInput) {
                qty = Math.max(1, parseInt(qtyInput.value || '1', 10));
            }
            if (cart[itemId]) {
                cart[itemId].qty += qty;
            } else {
                cart[itemId] = { name: itemName, price: price, qty: qty };
            }
            saveCart();
            updateCartBadge();
        }
        
        function updateCartBadge() {
            const itemCount = Object.keys(cart).length;
            const badge = document.getElementById('cart-count');
            if (itemCount > 0) {
                badge.innerText = itemCount;
                badge.style.display = 'inline';
            } else {
                badge.style.display = 'none';
            }
        }
        
        function saveCart() {
            localStorage.setItem('cart', JSON.stringify(cart));
        }
        
        // Load cart on page load
        window.addEventListener('load', loadCart);
    </script>
</body>
</html>
